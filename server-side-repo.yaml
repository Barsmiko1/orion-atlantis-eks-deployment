repos:
- id: github.com/Barsmiko1/orion-atlantis-eks-deployment
  workflow: custom
  allowed_overrides: [workflow, apply_requirements]
  allow_custom_workflows: true

workflows:
  custom:
    plan:
      steps:
      - env:
          name: ATLANTIS_TERRAFORM_VARS
          command: 'echo "-var atlantis_github_user=$ATLANTIS_GH_USER -var atlantis_github_token=$ATLANTIS_GH_TOKEN -var atlantis_repo_allowlist=$ATLANTIS_REPO_ALLOWLIST -var atlantis_webhook_secret=$ATLANTIS_GH_WEBHOOK_SECRET"'
      - init
      - run: terraform plan $(eval $ATLANTIS_TERRAFORM_VARS)
    apply:
      steps:
      - env:
          name: ATLANTIS_TERRAFORM_VARS
          command: 'echo "-var atlantis_github_user=$ATLANTIS_GH_USER -var atlantis_github_token=$ATLANTIS_GH_TOKEN -var atlantis_repo_allowlist=$ATLANTIS_REPO_ALLOWLIST -var atlantis_webhook_secret=$ATLANTIS_GH_WEBHOOK_SECRET"'
      - init
      - run: terraform apply $(eval $ATLANTIS_TERRAFORM_VARS)
